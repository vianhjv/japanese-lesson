<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªá th·ªëng h·ªçc ch·ªØ c√°i N5 - To√†n di·ªán</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #3498db; --secondary: #2ecc71; --accent: #9b59b6; --bg: #f8f9fa; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        
        .app-container { width: 100%; max-width: 500px; }
        
        /* B·ªë c·ª•c Mobile: Info tr√™n, Canvas d∆∞·ªõi */
        .learning-card { background: #fff; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; overflow: hidden; }
        
        .info-section { display: flex; align-items: center; padding: 15px; background: #fdfdfd; border-bottom: 1px solid #f0f0f0; }
        .info-left { flex: 1; }
        .romaji { font-size: 2.2rem; font-weight: bold; color: var(--primary); line-height: 1; }
        .vocab { font-size: 1rem; color: #333; font-weight: bold; margin-top: 5px; }
        .mean { font-size: 0.85rem; color: #666; }
        .emoji { font-size: 3rem; }

        .writing-section { height: 220px; display: flex; justify-content: center; align-items: center; background: #fff; touch-action: none; gap: 5px; }
        .writer-box { width: 180px; height: 180px; }
        .writer-box-s { width: 110px; height: 110px; margin-top: 50px; }

        .btn-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .btn { border: none; border-radius: 12px; padding: 12px; color: #fff; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .btn-audio { background: var(--accent); }
        .btn-play { background: var(--secondary); }
        .btn-quiz { background: var(--primary); }

        /* Tabs cho c√°c lo·∫°i ch·ªØ */
        .nav-tabs { display: flex; background: #eee; padding: 4px; border-radius: 12px; margin-bottom: 10px; font-size: 0.8rem; }
        .nav-tab { flex: 1; padding: 10px 5px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .nav-tab.active { background: #fff; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* L∆∞·ªõi ch·ªØ c√°i */
        .char-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; background: #fff; padding: 10px; border-radius: 15px; max-height: 250px; overflow-y: auto; }
        .char-grid.yoon { grid-template-columns: repeat(3, 1fr); }
        .char-item { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .char-item.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="learning-card">
        <div class="info-section">
            <div class="info-left">
                <div id="disp-romaji" class="romaji">A</div>
                <div id="disp-vocab" class="vocab">„ÅÇ„ÇÅ</div>
                <div id="disp-mean" class="mean">C∆°n m∆∞a</div>
            </div>
            <div id="disp-emoji" class="emoji">‚òî</div>
        </div>
        <div class="writing-section">
            <div id="t1" class="writer-box"></div>
            <div id="t2" class="writer-box-s" style="display:none"></div>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-audio" onclick="talk()"><i class="fas fa-volume-up"></i>Nghe</button>
        <button class="btn btn-play" onclick="showMe()"><i class="fas fa-eye"></i>M·∫´u</button>
        <button class="btn btn-quiz" onclick="tryWrite()"><i class="fas fa-pen-fancy"></i>Vi·∫øt</button>
    </div>

    <div class="nav-tabs">
        <div id="tab-hira" class="nav-tab active" onclick="switchType('hira')">Hiragana</div>
        <div id="tab-kata" class="nav-tab" onclick="switchType('kata')">Katakana</div>
        <div id="tab-yoon" class="nav-tab" onclick="switchType('yoon')">√Çm gh√©p</div>
    </div>

    <div id="grid" class="char-grid"></div>
</div>

<script>
    // 1. D·ªÆ LI·ªÜU T·ª™ V·ª∞NG CHI TI·∫æT
    const VOCAB_DB = {
        '„ÅÇ': { r: 'A', w: '„ÅÇ„ÇÅ', m: 'C∆°n m∆∞a', i: '‚òî' },
        '„ÅÑ': { r: 'I', w: '„ÅÑ„Å¨', m: 'Con ch√≥', i: 'üê∂' },
        '„ÅÜ': { r: 'U', w: '„ÅÜ„Åø', m: 'Bi·ªÉn', i: 'üåä' },
        '„Åà': { r: 'E', w: '„Åà„Çì„Å¥„Å§', m: 'B√∫t ch√¨', i: '‚úèÔ∏è' },
        '„Åä': { r: 'O', w: '„Åä„Å´„Åé„Çä', m: 'C∆°m n·∫Øm', i: 'üçô' },
        '„Ç¢': { r: 'A', w: '„Ç¢„Ç§„Çπ', m: 'Kem', i: 'üç¶' },
        '„Ç§': { r: 'I', w: '„Ç§„É≥„ÇØ', m: 'M·ª±c', i: 'üñãÔ∏è' },
        '„Åç„ÇÉ': { r: 'Kya', w: '„Åç„ÇÉ„Åè', m: 'Kh√°ch h√†ng', i: 'üë§' },
        '„Åç„ÇÖ': { r: 'Kyu', w: '„Åç„ÇÖ„ÅÜ„Çä', m: 'D∆∞a chu·ªôt', i: 'ü•í' },
        // Th√™m c√°c t·ª´ kh√°c t∆∞∆°ng t·ª± ·ªü ƒë√¢y...
    };

    // 2. DANH S√ÅCH CH·ªÆ C√ÅI CHO GRID
    const CHAR_LISTS = {
        hira: ['„ÅÇ','„ÅÑ','„ÅÜ','„Åà','„Åä','„Åã','„Åç','„Åè','„Åë','„Åì','„Åï','„Åó','„Åô','„Åõ','„Åù','„Åü','„Å°','„Å§','„Å¶','„Å®','„Å™','„Å´','„Å¨','„Å≠','„ÅÆ','„ÅØ','„Å≤','„Åµ','„Å∏','„Åª','„Åæ','„Åø','„ÇÄ','me','mo','ya','yu','yo','ra','ri','ru','re','ro','wa','wo','„Çì'],
        kata: ['„Ç¢','„Ç§','„Ç¶','„Ç®','„Ç™','„Ç´','„Ç≠','„ÇØ','„Ç±','„Ç≥','„Çµ','„Ç∑','„Çπ','„Çª','„ÇΩ','„Çø','„ÉÅ','„ÉÑ','„ÉÜ','„Éà','„Éä','„Éã','„Éå','„Éç','„Éé','„Éè','„Éí','„Éï','„Éò','„Éõ','„Éû','„Éü','„É†','„É°','„É¢','„É§','„É¶','„É®','„É©','„É™','„É´','„É¨','„É≠','„ÉØ','„É≤','„É≥'],
        yoon: ['„Åç„ÇÉ','„Åç„ÇÖ','„Åç„Çá','„Åó„ÇÉ','„Åó„ÇÖ','„Åó„Çá','„Å°„ÇÉ','„Å°„ÇÖ','„Å°„Çá','„Å´„ÇÉ','„Å´„ÇÖ','„Å´„Çá','„Å≤„ÇÉ','„Å≤„ÇÖ','„Å≤„Çá','„Åø„ÇÉ','„Åø„ÇÖ','„Åø„Çá','„Çä„ÇÉ','„Çä„ÇÖ','„Çä„Çá']
    };

    let curChar = '„ÅÇ', curType = 'hira', writers = [];

    function switchType(type) {
        curType = type;
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + type).classList.add('active');
        const grid = document.getElementById('grid');
        grid.className = 'char-grid ' + (type === 'yoon' ? 'yoon' : '');
        renderGrid();
        selectChar(CHAR_LISTS[type][0]);
    }

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        CHAR_LISTS[curType].forEach(c => {
            const div = document.createElement('div');
            div.className = 'char-item' + (c === curChar ? ' active' : '');
            div.innerText = c;
            div.onclick = () => selectChar(c);
            grid.appendChild(div);
        });
    }

    function selectChar(c) {
        curChar = c;
        renderGrid();
        
        // C·∫≠p nh·∫≠t UI Info
        const info = VOCAB_DB[c] || { r: '?', w: c, m: 'ƒêang c·∫≠p nh·∫≠t', i: 'üáØüáµ' };
        document.getElementById('disp-romaji').innerText = info.r;
        document.getElementById('disp-vocab').innerText = info.w;
        document.getElementById('disp-mean').innerText = info.m;
        document.getElementById('disp-emoji').innerText = info.i;

        // C·∫≠p nh·∫≠t Khung vi·∫øt
        const chars = c.split('');
        document.getElementById('t1').innerHTML = '';
        document.getElementById('t2').innerHTML = '';
        document.getElementById('t2').style.display = chars.length > 1 ? 'block' : 'none';
        
        writers = [initWriter('t1', chars[0], 180)];
        if(chars.length > 1) writers.push(initWriter('t2', chars[1], 110));
    }

    function initWriter(id, char, size) {
        return HanziWriter.create(id, char, {
            width: size, height: size, padding: 10,
            strokeColor: '#2c3e50', drawingColor: '#3498db',
            charDataLoader: (charToLoad, onComplete) => {
                fetch(`https://cdn.jsdelivr.net/gh/ailectra/kana-json@master/data/${encodeURIComponent(charToLoad)}.json`)
                    .then(res => res.json()).then(d => onComplete(d));
            }
        });
    }

    function talk() {
        const msg = new SpeechSynthesisUtterance(curChar);
        msg.lang = 'ja-JP';
        window.speechSynthesis.speak(msg);
    }

    async function showMe() {
        for (let w of writers) await w.animateCharacter();
    }

    function tryWrite() {
        if(writers.length === 1) {
            writers[0].quiz();
        } else {
            writers[0].quiz({ onComplete: () => writers[1].quiz() });
        }
    }

    window.onload = () => switchType('hira');
</script>
</body>
</html>
