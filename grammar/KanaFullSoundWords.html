<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>An's Japanese - Mobile Optimized</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #3498db; --secondary: #2ecc71; --accent: #9b59b6; --bg: #f0f2f5; --card: #ffffff; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); 
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        .app-container { width: 100%; max-width: 500px; }

        /* Writing Zone - Linh ho·∫°t cho Mobile */
        .learning-box {
            background: var(--card); border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            margin-bottom: 15px; overflow: hidden; display: flex; flex-direction: column;
        }

        /* Ph·∫ßn th√¥ng tin ph√≠a tr√™n */
        .info-bar {
            display: flex; align-items: center; padding: 15px;
            background: linear-gradient(to right, #f8fbff, #ffffff);
            border-bottom: 1px solid #eee;
        }
        .info-main { flex: 1; }
        .info-romaji { font-size: 2rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .info-text { font-size: 0.9rem; color: #666; margin-top: 4px; }
        .info-visual { font-size: 2.5rem; }

        /* Khu v·ª±c vi·∫øt ch√≠nh - Quan tr·ªçng nh·∫•t */
        .canvas-area {
            height: 240px; display: flex; justify-content: center; align-items: center;
            position: relative; touch-action: none; /* Ch·ªëng scroll khi v·∫Ω */
            background: #fff; gap: 10px;
        }
        .writer-container { width: 200px; height: 200px; }
        .writer-container.small { width: 120px; height: 120px; margin-top: 60px; }

        /* N√∫t h√†nh ƒë·ªông */
        .action-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn { 
            border: none; border-radius: 12px; padding: 12px 5px; color: white;
            font-weight: bold; font-size: 0.9rem; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .btn-audio { background: var(--accent); }
        .btn-play { background: var(--secondary); }
        .btn-quiz { background: var(--primary); }
        .btn i { font-size: 1.2rem; }

        /* Tabs & Grid */
        .tabs { display: flex; background: #ddd; padding: 4px; border-radius: 12px; margin-bottom: 10px; }
        .tab { flex: 1; padding: 8px; text-align: center; border-radius: 10px; font-weight: bold; font-size: 0.8rem; cursor: pointer; }
        .tab.active { background: white; color: var(--primary); }

        .grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            padding: 5px; background: #fff; border-radius: 15px;
            max-height: 250px; overflow-y: auto;
        }
        .char-card { 
            aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center;
            background: #fff; border: 1px solid #eee; border-radius: 10px;
            font-size: 1.2rem; font-weight: bold; transition: 0.2s;
        }
        .char-card.active { background: var(--primary); color: white; transform: scale(0.9); }

        #status { text-align: center; color: #e67e22; font-size: 0.85rem; font-weight: bold; height: 20px; margin-bottom: 5px; }

        /* Responsive cho m√†n h√¨nh ngang ho·∫∑c Desktop */
        @media (min-width: 600px) {
            .learning-box { flex-direction: row; height: 250px; }
            .info-bar { width: 150px; flex-direction: column; border-bottom: none; border-right: 1px solid #eee; }
            .canvas-area { flex: 1; height: auto; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div id="status">S·∫µn s√†ng h·ªçc c√πng An!</div>
    
    <div class="learning-box">
        <div class="info-bar">
            <div class="info-main">
                <div id="info-romaji" class="info-romaji">A</div>
                <div id="info-word" class="info-text">„ÅÇ„ÇÅ (Ame)</div>
                <div id="info-mean" class="info-text">C∆°n m∆∞a</div>
            </div>
            <div id="info-icon" class="info-visual">‚òî</div>
        </div>

        <div class="canvas-area">
            <div id="t1" class="writer-container"></div>
            <div id="t2" class="writer-container small" style="display: none;"></div>
        </div>
    </div>

    <div class="action-bar">
        <button class="btn btn-audio" onclick="playVoice()"><i class="fas fa-volume-up"></i>Nghe</button>
        <button class="btn btn-play" onclick="animateAll()"><i class="fas fa-play"></i>M·∫´u</button>
        <button class="btn btn-quiz" onclick="startQuiz()"><i class="fas fa-pen-nib"></i>Vi·∫øt</button>
    </div>

    <div class="tabs">
        <div id="t-hira" class="tab active" onclick="setMode('hira')">Hiragana</div>
        <div id="t-kata" class="tab" onclick="setMode('kata')">Katakana</div>
    </div>

    <div id="grid" class="grid"></div>
</div>

<script>
    // D·ªØ li·ªáu t·ª´ v·ª±ng m·ªü r·ªông
    const VOCAB = {
        '„ÅÇ': { r: 'A', w: '„ÅÇ„ÇÅ (Ame)', m: 'C∆°n m∆∞a', i: '‚òî' },
        '„ÅÑ': { r: 'I', w: '„ÅÑ„Å¨ (Inu)', m: 'Con ch√≥', i: 'üê∂' },
        '„ÅÜ': { r: 'U', w: '„ÅÜ„Åø (Umi)', m: 'Bi·ªÉn', i: 'üåä' },
        '„Åà': { r: 'E', w: '„Åà„Çì„Å¥„Å§ (Enpitsu)', m: 'B√∫t ch√¨', i: '‚úèÔ∏è' },
        '„Åä': { r: 'O', w: '„Åä„Å´„Åé„Çä (Onigiri)', m: 'C∆°m n·∫Øm', i: 'üçô' },
        '„Åã': { r: 'Ka', w: '„Åã„ÇÅ (Kame)', m: 'Con r√πa', i: 'üê¢' },
        '„Åç': { r: 'Ki', w: '„Åç„Å§„Å≠ (Kitsune)', m: 'Con c√°o', i: 'ü¶ä' },
        // ... (B·∫°n c√≥ th·ªÉ th√™m ti·∫øp t·∫°i ƒë√¢y)
    };

    const CHARS = [['„ÅÇ','a'],['„ÅÑ','i'],['„ÅÜ','u'],['„Åà','e'],['„Åä','o'],['„Åã','ka'],['„Åç','ki'],['„Åè','ku'],['„Åë','ke'],['„Åì','ko'],['„Åï','sa'],['„Åó','shi'],['„Åô','su'],['„Åõ','se'],['„Åù','so']];

    let curChar = '„ÅÇ', writers = [];

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        CHARS.forEach(item => {
            const card = document.createElement('div');
            card.className = 'char-card' + (item[0]===curChar?' active':'');
            card.innerText = item[0];
            card.onclick = () => selectChar(item[0]);
            grid.appendChild(card);
        });
    }

    function selectChar(c) {
        curChar = c;
        renderGrid();
        
        // C·∫≠p nh·∫≠t th√¥ng tin
        const data = VOCAB[c] || { r: c.toUpperCase(), w: c, m: 'T·ª´ v·ª±ng', i: 'üáØüáµ' };
        document.getElementById('info-romaji').innerText = data.r;
        document.getElementById('info-word').innerText = data.w;
        document.getElementById('info-mean').innerText = data.m;
        document.getElementById('info-icon').innerText = data.i;

        // C·∫≠p nh·∫≠t khung vi·∫øt
        document.getElementById('t1').innerHTML = '';
        document.getElementById('t2').innerHTML = '';
        writers = [createW('t1', c, 200)];
    }

    function createW(id, char, size) {
        return HanziWriter.create(id, char, {
            width: size, height: size, padding: 10,
            strokeColor: '#2c3e50', drawingColor: '#3498db',
            charDataLoader: (charToLoad, onComplete) => {
                fetch(`https://cdn.jsdelivr.net/gh/ailectra/kana-json@master/data/${encodeURIComponent(charToLoad)}.json`)
                    .then(res => res.json()).then(d => { 
                        document.getElementById('status').innerText = "S·∫µn s√†ng!";
                        onComplete(d); 
                    });
            }
        });
    }

    function playVoice() {
        const ut = new SpeechSynthesisUtterance(curChar);
        ut.lang = 'ja-JP';
        window.speechSynthesis.speak(ut);
    }

    async function animateAll() {
        for (let w of writers) await w.animateCharacter();
    }

    function startQuiz() {
        document.getElementById('status').innerText = "M·ªùi b·∫°n t·∫≠p vi·∫øt...";
        writers[0].quiz({ onComplete: () => document.getElementById('status').innerText = "Gi·ªèi l·∫Øm!" });
    }

    window.onload = () => { renderGrid(); selectChar('„ÅÇ'); };
</script>
</body>
</html>
